<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Python爬虫4-爬虫进阶, Hexo-Xiong">
    <meta name="description" content="一、多线程爬虫参考海燕Socket编程：https://www.cnblogs.com/haiyan123/p/8387770.html#lable7有些时候，比如下载图片，因为下载图片是一个耗时的操作。如果采用之前那种同步的方式下载。那效">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    

    <title>Python爬虫4-爬虫进阶 | Hexo-Xiong</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.1.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo-Xiong</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/journal" class="waves-effect waves-light">
      
      <i class="fa fa-book" style="zoom: 0.6;"></i>
      
      <span>日志</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/census" class="waves-effect waves-light">
      
      <i class="fa fa-layer-group" style="zoom: 0.6;"></i>
      
      <span>统计</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>Medias</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/musics">
          
          <i class="fa-solid fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Musics</span>
        </a>
      </li>
      
      <li>
        <a href="/movies">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Movies</span>
        </a>
      </li>
      
      <li>
        <a href="/mygallery">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>myGallery</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo-Xiong</div>
        <div class="logo-desc">
            
            小熊同学是一名Java开发工程师，在编程的道路上孜孜不倦的追求技术成长，愿与诸位共同进步！
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/journal" class="waves-effect waves-light">
			
			    <i class="fa-fw fa fa-book"></i>
			
			日志
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/census" class="waves-effect waves-light">
			
			    <i class="fa-fw fa fa-layer-group"></i>
			
			统计
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			Medias
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/musics " style="margin-left:75px">
				  
				   <i class="fa fa-solid fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>Musics</span>
                  </a>
                </li>
              
                <li>

                  <a href="/movies " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>Movies</span>
                  </a>
                </li>
              
                <li>

                  <a href="/mygallery " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>myGallery</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/bfd2018/" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/bfd2018/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    <meta name="referrer" content="no-referrer" />




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Python爬虫4-爬虫进阶</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                            <a href="/tags/%E7%88%AC%E8%99%AB/">
                                <span class="chip bg-color">爬虫</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Python%E7%88%AC%E8%99%AB/" class="post-category">
                                Python爬虫
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-06-14
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-06-14
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    42 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="一、多线程爬虫"><a href="#一、多线程爬虫" class="headerlink" title="一、多线程爬虫"></a>一、多线程爬虫</h2><p>参考海燕Socket编程：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/haiyan123/p/8387770.html#lable7">https://www.cnblogs.com/haiyan123/p/8387770.html#lable7</a><br>有些时候，比如下载图片，因为下载图片是一个耗时的操作。如果采用之前那种同步的方式下载。那效率肯会特别慢。这时候我们就可以考虑使用多线程的方式来下载图片。</p>
<h3 id="1-多线程介绍："><a href="#1-多线程介绍：" class="headerlink" title="1.多线程介绍："></a>1.多线程介绍：</h3><p>多线程是为了同步完成多项任务，通过提高资源使用效率来提高系统的效率。线程是在同一时间需要完成多项任务的时候实现的。<br>最简单的比喻多线程就像火车的每一节车厢，而进程则是火车。车厢离开火车是无法跑动的，同理火车也可以有多节车厢。多线程的出现就是为了提高效率。同时它的出现也带来了一些问题。更多介绍请参考：<br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A4%9A%E7%BA%BF%E7%A8%8B">https://zh.wikipedia.org/wiki/%E5%A4%9A%E7%BA%BF%E7%A8%8B</a></p>
<h3 id="2-threading模块介绍："><a href="#2-threading模块介绍：" class="headerlink" title="2.threading模块介绍："></a>2.threading模块介绍：</h3><p><code>threading</code>模块是<code>python</code>中专门提供用来做多线程编程的模块。<code>threading</code>模块中最常用的类是<code>Thread</code>。以下看一个简单的多线程程序：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">coding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在写代码%s'</span><span class="token operator">%</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">drawing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在画图%s'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>coding<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment">#给函数添加参数，args要是列表或元组</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>drawing<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#当前所有线程</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
    <span class="token comment">#[&lt;_MainThread(MainThread, started 6876)&gt;, &lt;Thread(Thread-1, started 3112)&gt;, &lt;Thread(Thread-2, started 14792)&gt;]</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-1-线程Threading的属性和方法："><a href="#2-1-线程Threading的属性和方法：" class="headerlink" title="2.1 线程Threading的属性和方法："></a>2.1 线程Threading的属性和方法：</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">threading模块提供的一些方法：
  <span class="token comment"># threading.currentThread(): 返回当前的线程信息。</span>
  <span class="token comment"># threading.enumerate(): 返回一个包含正在运行的所有线程的list。</span>
  <span class="token comment"># threading.activeCount(): 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-2-Threading-Thread-实例对象方法："><a href="#2-2-Threading-Thread-实例对象方法：" class="headerlink" title="2.2 Threading.Thread()实例对象方法："></a>2.2 <code>Threading.Thread()</code>实例对象方法：</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Thread实例对象的方法
  <span class="token comment"># is_alive(): 返回线程是否活动的。True/False</span>
  <span class="token comment"># getName(): 返回线程名。</span>
  <span class="token comment"># setName(): 设置线程名。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>示例如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span>  threading <span class="token keyword">import</span> Thread
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">import</span> time<span class="token punctuation">,</span>os<span class="token punctuation">,</span>threading

<span class="token keyword">def</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s is running'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#当前线程</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#得到其他线程的名字</span>
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>work<span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#主线程的名字</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#主线程</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#连同主线程在内有两个运行的线程</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#判断线程是否存活</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>activeCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'主'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1559629/1601216560729-3096c529-2d36-4b1d-a50b-e87f27bdc6da.png#id=djhFl&amp;originHeight=208&amp;originWidth=421&amp;originalType=binary&amp;ratio=1&amp;status=done&amp;style=none"><br>示例代码稍作修改：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process
<span class="token keyword">import</span> time<span class="token punctuation">,</span> os<span class="token punctuation">,</span> threading
<span class="token keyword">def</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># time.sleep(2)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s is running'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	t <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>work<span class="token punctuation">)</span>
	t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 主线程的名字</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 主线程</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 连同主线程在内有两个运行的线程</span>
	time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 判断线程是否存活</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>activeCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'主线程'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/1559629/1601216560766-a9279422-d10a-429c-abe8-1266c08f6035.png#id=CEYdG&amp;originHeight=209&amp;originWidth=782&amp;originalType=binary&amp;ratio=1&amp;status=done&amp;style=none"><br>为了让线程代码更好的封装。可以使用<code>threading</code>模块下的<code>Thread</code>类，继承自这个类，然后实现<code>run</code>方法，线程就会自动运行<code>run</code>方法中的代码。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">class</span> <span class="token class-name">CodingThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s正在写代码'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">DrawingThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s正在画图'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">multi_thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> CodingThread<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> DrawingThread<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    multi_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-多线程共享全局变量的问题"><a href="#3-多线程共享全局变量的问题" class="headerlink" title="3.多线程共享全局变量的问题"></a>3.多线程共享全局变量的问题</h3><p>多线程都是在同一个进程中运行的。因此在进程中的全局变量所有线程都是可共享的。这就造成了一个问题，因为线程执行的顺序是无序的。有可能会造成数据错误。比如以下代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
VALUE <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">add_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> VALUE
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        VALUE <span class="token operator">+=</span> <span class="token number">1</span>      <span class="token comment">#子作用域中修改全局变量时必须先声明 global VALUE</span>
        
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'value：%d'</span><span class="token operator">%</span>VALUE<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>add_value<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上结果正常来讲应该是1000000  2000000，但是因为多线程运行的不确定性。因此最后的结果可能是随机的。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1559629/1601216560801-c400a98e-3a35-49b9-b562-27137d8dd097.png#id=mtGK3&amp;originHeight=58&amp;originWidth=180&amp;originalType=binary&amp;ratio=1&amp;status=done&amp;style=none"></p>
<h3 id="4-锁机制："><a href="#4-锁机制：" class="headerlink" title="4.锁机制："></a>4.锁机制：</h3><p>为了解决以上使用共享全局变量（修改全局变量）的问题。<code>threading</code>提供了一个<code>Lock</code>类，这个类可以在某个线程访问某个变量的时候加锁，其他线程此时就不能进来，直到当前线程处理完后，把锁释放了，其他线程才能进来处理。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
VALUE <span class="token operator">=</span> <span class="token number">0</span>
gLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> VALUE
    gLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        VALUE <span class="token operator">+=</span> <span class="token number">1</span>
    gLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'value：%d'</span><span class="token operator">%</span>VALUE<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>add_value<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：不要随便使用锁，只有多个线程修改全局变量时才需要加锁，如果只是访问那么不需要加锁。</p>
<h3 id="5-Lock版本生产者和消费者模式："><a href="#5-Lock版本生产者和消费者模式：" class="headerlink" title="5.Lock版本生产者和消费者模式："></a>5.Lock版本生产者和消费者模式：</h3><p>生产者和消费者模式是多线程开发中经常见到的一种模式。生产者的线程专门用来生产一些数据，然后存放到一个中间的变量中。消费者再从这个中间的变量中取出数据进行消费。但是因为要使用中间变量，中间变量经常是一些全局变量，因此需要使用锁来保证数据完整性。以下是使用<code>threading.Lock</code>锁实现的“生产者与消费者模式”的一个例子：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time
gMoney <span class="token operator">=</span> <span class="token number">1000</span>
gLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 记录生产者生产的次数，达到10次就不再生产</span>
gTimes <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">class</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> gMoney
        <span class="token keyword">global</span> gLock
        <span class="token keyword">global</span> gTimes
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            money <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            gLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 如果已经达到10次了，就不再生产了</span>
            <span class="token keyword">if</span> gTimes <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">:</span>
                gLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            gMoney <span class="token operator">+=</span> money
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s当前存入%s元钱，剩余%s元钱'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> money<span class="token punctuation">,</span> gMoney<span class="token punctuation">)</span><span class="token punctuation">)</span>
            gTimes <span class="token operator">+=</span> <span class="token number">1</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
            gLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> gMoney
        <span class="token keyword">global</span> gLock
        <span class="token keyword">global</span> gTimes
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            money <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
            gLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> gMoney <span class="token operator">&gt;</span> money<span class="token punctuation">:</span>
                gMoney <span class="token operator">-=</span> money
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s当前取出%s元钱，剩余%s元钱'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> money<span class="token punctuation">,</span> gMoney<span class="token punctuation">)</span><span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 如果钱不够了，有可能是已经超过了次数，这时候就判断一下</span>
                <span class="token keyword">if</span> gTimes <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">:</span>
                    gLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s当前想取%s元钱，剩余%s元钱，不足！"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>money<span class="token punctuation">,</span>gMoney<span class="token punctuation">)</span><span class="token punctuation">)</span>
            gLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        Consumer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'消费者线程%d'</span><span class="token operator">%</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        Producer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'生产者线程%d'</span><span class="token operator">%</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-Condition版的生产者与消费者模式："><a href="#6-Condition版的生产者与消费者模式：" class="headerlink" title="6.Condition版的生产者与消费者模式："></a>6.Condition版的生产者与消费者模式：</h3><p><code>Lock</code>版本的生产者与消费者模式可以正常的运行。但是存在一个不足，在消费者中，总是通过<code>while True</code>死循环并且上锁的方式去判断钱够不够。上锁是一个很耗费CPU资源的行为。因此这种方式不是最好的。还有一种更好的方式便是使用<code>threading.Condition</code>来实现。<code>threading.Condition</code>可以在没有数据的时候处于阻塞等待状态。一旦有合适的数据了，还可以使用<code>notify</code>相关的函数来通知其他处于等待状态的线程。这样就可以不用做一些无用的上锁和解锁的操作。可以提高程序的性能。首先对<code>threading.Condition</code>相关的函数做个介绍，<code>threading.Condition</code>类似<code>threading.Lock</code>，可以在修改全局数据的时候进行上锁，也可以在修改完毕后进行解锁。以下将一些常用的函数做个简单的介绍：</p>
<ol>
<li><code>acquire</code>：上锁。</li>
<li><code>release</code>：解锁。</li>
<li><code>wait</code>：将当前线程处于等待状态，并且会释放锁。可以被其他线程使用<code>notify</code>和<code>notify_all</code>函数唤醒。被唤醒后会继续等待上锁，上锁后继续执行下面的代码。</li>
<li><code>notify</code>：通知某个正在等待的线程，默认是第1个等待的线程。</li>
<li><code>notify_all</code>：通知所有正在等待的线程。<code>notify</code>和<code>notify_all</code>不会释放锁。并且需要在<code>release</code>之前调用。</li>
</ol>
<p><code>Condition</code>版的生产者与消费者模式代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading<span class="token punctuation">,</span>time<span class="token punctuation">,</span>random
gMONEY <span class="token operator">=</span> <span class="token number">1000</span>       <span class="token comment">#金库初始有1000元</span>
gTotalTimes <span class="token operator">=</span> <span class="token number">10</span>        <span class="token comment">#定义生产者生成10次</span>
gTimes <span class="token operator">=</span> <span class="token number">0</span>       <span class="token comment">#每生产一次，次数加一</span>
gCondition <span class="token operator">=</span> threading<span class="token punctuation">.</span>Condition<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">global</span> gMONEY
		<span class="token keyword">global</span> gTimes
		<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
			money <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
			gCondition<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> gTimes<span class="token operator">&lt;</span>gTotalTimes<span class="token punctuation">:</span>
				gTimes<span class="token operator">+=</span><span class="token number">1</span>
				gMONEY<span class="token operator">+=</span>money
				gCondition<span class="token punctuation">.</span>notify_all<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">#通知所有正在等待的线程</span>
				<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"生产者%s 生产了%s 剩余总金额是%s"</span><span class="token operator">%</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>money<span class="token punctuation">,</span>gMONEY<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				gCondition<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			gCondition<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
			time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">global</span> gMONEY
		<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
			money <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
			gCondition<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">while</span> gMONEY<span class="token operator">&lt;</span>money<span class="token punctuation">:</span>
				<span class="token comment">##可能一次生产的钱还不够消费的，或者生产的钱被其他消费者线程消费了造成余额不足</span>
				<span class="token comment">##使用while循环，直到金库的钱够消费为止</span>
				<span class="token keyword">if</span> gTimes<span class="token operator">&gt;=</span>gTotalTimes<span class="token punctuation">:</span>
					gCondition<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span>          <span class="token comment">#此处使用return 直接跳出函数，不能使用break break只能跳出一层while循环</span>
				<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s准备消费%s元钱，剩余%s元钱，余额不足！"</span><span class="token operator">%</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>money<span class="token punctuation">,</span>gMONEY<span class="token punctuation">)</span><span class="token punctuation">)</span>
				gCondition<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
			gMONEY<span class="token operator">-=</span>money
			<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s消费%s元钱，剩余%s元钱"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> money<span class="token punctuation">,</span> gMONEY<span class="token punctuation">)</span><span class="token punctuation">)</span>
			gCondition<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
			time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		t <span class="token operator">=</span> Customer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'消费者线程%s'</span><span class="token operator">%</span>x<span class="token punctuation">)</span>
		t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		t <span class="token operator">=</span> Producer<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'生产者线程%s'</span><span class="token operator">%</span>x<span class="token punctuation">)</span>
		t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打印结果：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">0</span><span class="token punctuation">,</span> started <span class="token number">17316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">836</span>元钱，剩余<span class="token number">164</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">17876</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>准备消费<span class="token number">656</span>元钱，剩余<span class="token number">164</span>元钱，余额不足！
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>准备消费<span class="token number">768</span>元钱，剩余<span class="token number">164</span>元钱，余额不足！
生产者生产者线程<span class="token number">0</span> 生产了<span class="token number">575</span> 剩余总金额是<span class="token number">739</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>准备消费<span class="token number">768</span>元钱，剩余<span class="token number">739</span>元钱，余额不足！
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">17876</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">656</span>元钱，剩余<span class="token number">83</span>元钱
生产者生产者线程<span class="token number">1</span> 生产了<span class="token number">470</span> 剩余总金额是<span class="token number">553</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>准备消费<span class="token number">768</span>元钱，剩余<span class="token number">553</span>元钱，余额不足！
生产者生产者线程<span class="token number">2</span> 生产了<span class="token number">552</span> 剩余总金额是<span class="token number">1105</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">768</span>元钱，剩余<span class="token number">337</span>元钱
生产者生产者线程<span class="token number">3</span> 生产了<span class="token number">631</span> 剩余总金额是<span class="token number">968</span>
生产者生产者线程<span class="token number">4</span> 生产了<span class="token number">512</span> 剩余总金额是<span class="token number">1480</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">0</span><span class="token punctuation">,</span> started <span class="token number">17316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">411</span>元钱，剩余<span class="token number">1069</span>元钱
生产者生产者线程<span class="token number">0</span> 生产了<span class="token number">730</span> 剩余总金额是<span class="token number">1799</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">17876</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">934</span>元钱，剩余<span class="token number">865</span>元钱
生产者生产者线程<span class="token number">1</span> 生产了<span class="token number">802</span> 剩余总金额是<span class="token number">1667</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">559</span>元钱，剩余<span class="token number">1108</span>元钱
生产者生产者线程<span class="token number">2</span> 生产了<span class="token number">827</span> 剩余总金额是<span class="token number">1935</span>
生产者生产者线程<span class="token number">3</span> 生产了<span class="token number">319</span> 剩余总金额是<span class="token number">2254</span>
生产者生产者线程<span class="token number">4</span> 生产了<span class="token number">633</span> 剩余总金额是<span class="token number">2887</span>
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">0</span><span class="token punctuation">,</span> started <span class="token number">17316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">132</span>元钱，剩余<span class="token number">2755</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">17876</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">676</span>元钱，剩余<span class="token number">2079</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">240</span>元钱，剩余<span class="token number">1839</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">0</span><span class="token punctuation">,</span> started <span class="token number">17316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">284</span>元钱，剩余<span class="token number">1555</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">1</span><span class="token punctuation">,</span> started <span class="token number">17876</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">150</span>元钱，剩余<span class="token number">1405</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">717</span>元钱，剩余<span class="token number">688</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">0</span><span class="token punctuation">,</span> started <span class="token number">17316</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">441</span>元钱，剩余<span class="token number">247</span>元钱
<span class="token operator">&lt;</span>Customer<span class="token punctuation">(</span>消费者线程<span class="token number">2</span><span class="token punctuation">,</span> started <span class="token number">3992</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>消费<span class="token number">215</span>元钱，剩余<span class="token number">32</span>元钱<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-Queue线程安全队列："><a href="#7-Queue线程安全队列：" class="headerlink" title="7.Queue线程安全队列："></a>7.Queue线程安全队列：</h3><p>参考：<a target="_blank" rel="noopener" href="https://_docs.python.org_zh-cn_3.6_library_queue/">https://docs.python.org/zh-cn/3.6/library/queue.html</a><br>在线程中，访问一些全局变量，加锁是一个经常的过程。如果你是想把一些数据存储到某个队列中，那么Python内置了一个线程安全的模块叫做<code>queue</code>模块。Python中的queue模块中提供了同步的、线程安全的队列类，包括FIFO（先进先出）队列Queue，LIFO（后入先出）队列LifoQueue即栈。这些队列都实现了锁原语（可以理解为原子操作，即要么不做，要么都做完），能够在多线程中直接使用。可以使用队列来实现线程间的同步。<br>队列对象 (<code>[Queue](https://docs.python.org/zh-cn/3.6/library/queue.html#queue.Queue)</code>, <code>[LifoQueue](https://docs.python.org/zh-cn/3.6/library/queue.html#queue.LifoQueue)</code>, 或者 <code>[PriorityQueue](https://docs.python.org/zh-cn/3.6/library/queue.html#queue.PriorityQueue)</code>) 提供下列描述的公共方法:</p>
<ol>
<li><p><code>queue.Queue(maxsize)</code>：创建一个先进先出的队列。</p>
</li>
<li><p><code>queue.Queue.qsize()</code>：返回队列的大小。</p>
</li>
<li><p><code>queue.Queue.empty()</code>：判断队列是否为空。</p>
</li>
<li><p><code>queue.Queue.full()</code>：判断队列是否满了。</p>
</li>
<li><p><code>queue.Queue.get()</code>：从队列中取最后一个数据(即最先进入队列的值)</p>
</li>
<li><p><code>queue.Queue.put()</code>：将一个数据放到队列中。</p>
</li>
<li><p><code>queue.Queue.task_done()</code>：表示前面排队的任务已经被完成。被队列的消费者线程使用。每个 get() 被用于获取一个任务， 后续调用 task_done() 告诉队列，该任务的处理已经完成。<br>如果 join() 当前正在阻塞，在所有条目都被处理后，将解除阻塞(意味着每个 put() 进队列的条目的 task_done() 都被收到)。<br>如果被调用的次数多于放入队列中的项目数量，将引发 ValueError 异常 。</p>
</li>
<li><p><code>queue.Queue.join()</code>：阻塞至队列中所有的元素都被接收和处理完毕。<br>当条目添加到队列的时候，未完成任务的计数就会增加。每当消费者线程调用 task_done() 表示这个条目已经被回收，该条目所有工作已经完成，未完成计数就会减少。当未完成计数降到零的时候， join() 阻塞被解除。</p>
<h4 id="方法参数："><a href="#方法参数：" class="headerlink" title="方法参数："></a>方法参数：</h4><p><code>q.put(block=True)</code>：如果队列已满再设置值时会一直阻塞，直到队列大小小于maxsize（默认block为True）<br><code>q.get(block=True)</code>：如果队列没有值了会一直阻塞（默认block为True）<br>示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> queue<span class="token punctuation">,</span>threading<span class="token punctuation">,</span>time
<span class="token keyword">def</span> <span class="token function">set_value</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>
	index <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
		q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>index<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'向队列中添加了值：%s'</span> <span class="token operator">%</span> index<span class="token punctuation">)</span>
		index <span class="token operator">+=</span> <span class="token number">1</span>
		time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	q <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
	t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>set_value<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">)</span>
	t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>get_value<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">)</span>
	t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
	t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="8-使用生产者与消费者模式多线程下载表情包："><a href="#8-使用生产者与消费者模式多线程下载表情包：" class="headerlink" title="8.使用生产者与消费者模式多线程下载表情包："></a>8.使用生产者与消费者模式多线程下载表情包：</h3><p>生产者负责爬取图片url 和图片filename<br>消费者负责将图片下载到本地<br>当页面队列page_queue没有值时，生产者停止生产<br>当页面队列page_queue没有值并且 图片队列img_queue也没有值时，消费者停止消费<br>总结：从网络上获取url内容和图片存储到本地都是耗时的I/O操作，因此开启多个线程速度会加快很多。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> request
<span class="token keyword">import</span> os
<span class="token keyword">import</span> re
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
<span class="token keyword">class</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>page_queue<span class="token punctuation">,</span>img_queue<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Producer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>page_queue <span class="token operator">=</span> page_queue
        self<span class="token punctuation">.</span>img_queue <span class="token operator">=</span> img_queue
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>page_queue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            url <span class="token operator">=</span> self<span class="token punctuation">.</span>page_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>parse_page<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">parse_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
        text <span class="token operator">=</span> response<span class="token punctuation">.</span>text
        html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        imgs <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//div[@class='page-content text-center']//a//img"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> img <span class="token keyword">in</span> imgs<span class="token punctuation">:</span>
            <span class="token keyword">if</span> img<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'gif'</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            img_url <span class="token operator">=</span> img<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//@data-original"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            suffix <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>img_url<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            alt <span class="token operator">=</span> img<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//@alt"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            alt <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'[，。？?,/\\·]'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>alt<span class="token punctuation">)</span>
            img_name <span class="token operator">=</span> alt <span class="token operator">+</span> suffix
            self<span class="token punctuation">.</span>img_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>img_url<span class="token punctuation">,</span>img_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>page_queue<span class="token punctuation">,</span>img_queue<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Consumer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>page_queue <span class="token operator">=</span> page_queue
        self<span class="token punctuation">.</span>img_queue <span class="token operator">=</span> img_queue
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>img_queue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>page_queue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span>
            img <span class="token operator">=</span> self<span class="token punctuation">.</span>img_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span>block<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            url<span class="token punctuation">,</span>filename <span class="token operator">=</span> img
            request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span><span class="token string">'images/'</span><span class="token operator">+</span>filename<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>filename<span class="token operator">+</span><span class="token string">'  下载完成！'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    img_queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">"http://www.doutula.com/photo/list/?page=%d"</span> <span class="token operator">%</span> x
        page_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> Producer<span class="token punctuation">(</span>page_queue<span class="token punctuation">,</span>img_queue<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> Consumer<span class="token punctuation">(</span>page_queue<span class="token punctuation">,</span>img_queue<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="9-GIL全局解释器锁："><a href="#9-GIL全局解释器锁：" class="headerlink" title="9.GIL全局解释器锁："></a>9.GIL全局解释器锁：</h3><p>Python自带的解释器是<code>CPython</code>。<code>CPython</code>解释器的多线程实际上是一个假的多线程（在多核CPU中，只能利用一核，不能利用多核）。同一时刻只有一个线程在执行，为了保证同一时刻只有一个线程在执行，在<code>CPython</code>解释器中有一个东西叫做<code>GIL（Global Intepreter Lock）</code>，叫做全局解释器锁。这个解释器锁是有必要的。因为<code>CPython</code>解释器的内存管理不是线程安全的。当然除了<code>CPython</code>解释器，还有其他的解释器，有些解释器是没有<code>GIL</code>锁的，见下面：</p>
</li>
<li><p><code>Jython</code>：用Java实现的Python解释器。不存在GIL锁。更多详情请见：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Jython">https://zh.wikipedia.org/wiki/Jython</a></p>
</li>
<li><p><code>IronPython</code>：用<code>.net</code>实现的Python解释器。不存在GIL锁。更多详情请见：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/IronPython">https://zh.wikipedia.org/wiki/IronPython</a></p>
</li>
<li><p><code>PyPy</code>：用<code>Python</code>实现的Python解释器。存在GIL锁。更多详情请见：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/PyPy">https://zh.wikipedia.org/wiki/PyPy</a><br>GIL虽然是一个假的多线程。但是在处理一些IO操作（比如文件读写和网络请求）还是可以在很大程度上提高效率的。在IO操作上建议使用多线程提高效率。在一些CPU计算操作上不建议使用多线程，而建议使用多进程。</p>
<h3 id="10-多线程下载百思不得姐段子作业："><a href="#10-多线程下载百思不得姐段子作业：" class="headerlink" title="10.多线程下载百思不得姐段子作业："></a>10.多线程下载百思不得姐段子作业：</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">import</span> threading
<span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
<span class="token keyword">import</span> csv
<span class="token keyword">class</span> <span class="token class-name">BSSpider</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>page_queue<span class="token punctuation">,</span>joke_queue<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>BSSpider<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>base_domain <span class="token operator">=</span> <span class="token string">'http://www.budejie.com'</span>
        self<span class="token punctuation">.</span>page_queue <span class="token operator">=</span> page_queue
        self<span class="token punctuation">.</span>joke_queue <span class="token operator">=</span> joke_queue
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>page_queue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            url <span class="token operator">=</span> self<span class="token punctuation">.</span>page_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
            text <span class="token operator">=</span> response<span class="token punctuation">.</span>text
            html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
            descs <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//div[@class='j-r-list-c-desc']"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> desc <span class="token keyword">in</span> descs<span class="token punctuation">:</span>
                jokes <span class="token operator">=</span> desc<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//text()"</span><span class="token punctuation">)</span>
                joke <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>jokes<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                link <span class="token operator">=</span> self<span class="token punctuation">.</span>base_domain<span class="token operator">+</span>desc<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">".//a/@href"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                self<span class="token punctuation">.</span>joke_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>joke<span class="token punctuation">,</span>link<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token operator">*</span><span class="token number">30</span><span class="token operator">+</span><span class="token string">"第%s页下载完成！"</span><span class="token operator">%</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"="</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">BSWriter</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> joke_queue<span class="token punctuation">,</span> writer<span class="token punctuation">,</span>gLock<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>BSWriter<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>joke_queue <span class="token operator">=</span> joke_queue
        self<span class="token punctuation">.</span>writer <span class="token operator">=</span> writer
        self<span class="token punctuation">.</span>lock <span class="token operator">=</span> gLock
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                joke_info <span class="token operator">=</span> self<span class="token punctuation">.</span>joke_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
                joke<span class="token punctuation">,</span>link <span class="token operator">=</span> joke_info
                self<span class="token punctuation">.</span>lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span>joke<span class="token punctuation">,</span>link<span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'保存一条'</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    joke_queue <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    gLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'bsbdj.csv'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">'http://www.budejie.com/text/%d'</span> <span class="token operator">%</span> x
        page_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> BSSpider<span class="token punctuation">(</span>page_queue<span class="token punctuation">,</span>joke_queue<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> BSWriter<span class="token punctuation">(</span>joke_queue<span class="token punctuation">,</span>writer<span class="token punctuation">,</span>gLock<span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<hr>
<h2 id="二、Ajax动态数据抓取"><a href="#二、Ajax动态数据抓取" class="headerlink" title="二、Ajax动态数据抓取"></a>二、Ajax动态数据抓取</h2><p><strong>什么是AJAX：</strong><br>AJAX（Asynchronouse JavaScript And XML）异步JavaScript和XML。过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。传统的网页（不使用Ajax）如果需要更新内容，必须重载整个网页页面。因为传统的在传输数据格式方面，使用的是<code>XML</code>语法。因此叫做<code>AJAX</code>，其实现在数据交互基本上都是使用<code>JSON</code>。使用AJAX加载的数据，即使使用了JS，将数据渲染到了浏览器中，在<code>右键-&gt;查看网页源代码</code>还是不能看到通过ajax加载的数据，只能看到使用这个url加载的html代码。</p>
<h3 id="1-获取Ajax数据的方式："><a href="#1-获取Ajax数据的方式：" class="headerlink" title="1.获取Ajax数据的方式："></a>1.获取Ajax数据的方式：</h3><ol>
<li>直接分析ajax调用的接口。然后通过代码请求这个接口。</li>
<li>使用Selenium+chromedriver模拟浏览器行为获取数据。<table>
<thead>
<tr>
<th>方式</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>分析接口</td>
<td>直接可以请求到数据。不需要做一些解析工作。代码量少，性能高。</td>
<td>分析接口比较复杂，特别是一些通过js混淆的接口，要有一定的js功底。容易被发现是爬虫。</td>
</tr>
<tr>
<td>selenium</td>
<td>直接模拟浏览器的行为。浏览器能请求到的，使用selenium也能请求到。爬虫更稳定。</td>
<td>代码量多。性能低。</td>
</tr>
</tbody></table>
</li>
</ol>
<p><strong>Selenium+chromedriver获取动态数据：</strong><br><code>Selenium</code>相当于是一个机器人。可以模拟人类在浏览器上的一些行为，自动处理浏览器上的一些行为，比如点击，填充数据，删除cookie等。<code>chromedriver</code>是一个驱动<code>Chrome</code>浏览器的驱动程序，使用他才可以驱动浏览器。当然针对不同的浏览器有不同的driver。以下列出了不同浏览器及其对应的driver：</p>
<ol>
<li>Chrome：<a target="_blank" rel="noopener" href="https://sites.google.com/a/chromium.org/chromedriver/downloads">https://sites.google.com/a/chromium.org/chromedriver/downloads</a></li>
<li>Firefox：<a target="_blank" rel="noopener" href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a></li>
<li>Edge：<a target="_blank" rel="noopener" href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/</a></li>
<li>Safari：<a target="_blank" rel="noopener" href="https://webkit.org/blog/6900/webdriver-support-in-safari-10/">https://webkit.org/blog/6900/webdriver-support-in-safari-10/</a></li>
</ol>
<p><strong>安装Selenium和chromedriver：</strong></p>
<ol>
<li><p>安装Selenium：<br>Selenium有很多语言的版本，有java、ruby、python等。我们下载python版本的就可以了。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> selenium<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>安装<code>chromedriver</code>：下载<code>chromedriver.exe</code>之后，放到不需要权限的纯英文目录下就可以了。</p>
<h3 id="2-快速入门："><a href="#2-快速入门：" class="headerlink" title="2.快速入门："></a>2.快速入门：</h3><p>现在以一个简单的获取百度首页的例子来讲下<code>Selenium</code>和<code>chromedriver</code>如何快速入门：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token comment"># chromedriver的绝对路径</span>
driver_path <span class="token operator">=</span> <span class="token string">r'D:\ProgramApp\chromedriver\chromedriver.exe'</span>
<span class="token comment"># 初始化一个driver，并且指定chromedriver的路径</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span>driver_path<span class="token punctuation">)</span>
<span class="token comment"># 请求网页</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.baidu.com/"</span><span class="token punctuation">)</span>
<span class="token comment"># 通过page_source获取网页源代码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-selenium常用操作："><a href="#3-selenium常用操作：" class="headerlink" title="3.selenium常用操作："></a>3.selenium常用操作：</h3><p>更多教程请参考：<a target="_blank" rel="noopener" href="http://selenium-python.readthedocs.io/installation.html#introduction">http://selenium-python.readthedocs.io/installation.html#introduction</a><br><a target="_blank" rel="noopener" href="https://_www.cnblogs.com_xjt2018_p_10317359/">https://www.cnblogs.com/XJT2018/p/10317359.html</a></p>
<h4 id="关闭页面："><a href="#关闭页面：" class="headerlink" title="关闭页面："></a>关闭页面：</h4></li>
<li><p><code>driver.close()</code>：关闭当前页面。</p>
</li>
<li><p><code>driver.quit()</code>：退出整个浏览器。</p>
<h4 id="定位元素："><a href="#定位元素：" class="headerlink" title="定位元素："></a>定位元素：</h4><p>导入By：<code>from selenium.webdriver.common.by import By</code></p>
</li>
<li><p><code>find_element_by_id</code>：根据id来查找某个元素。等价于：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'su'</span><span class="token punctuation">)</span>
submitTag1 <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">'su'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>find_element_by_class_name</code>：根据类名查找元素。 等价于：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'su'</span><span class="token punctuation">)</span>
submitTag1 <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>CLASS_NAME<span class="token punctuation">,</span><span class="token string">'su'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>find_element_by_name</code>：根据name属性的值来查找元素（一些input标签有name属性）。等价于：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">)</span>
submitTag1 <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span><span class="token string">'email'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>find_element_by_tag_name</code>：根据标签名来查找元素。等价于：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
submitTag1 <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>TAG_NAME<span class="token punctuation">,</span><span class="token string">'div'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>find_element_by_xpath</code>：根据xpath语法来获取元素。等价于：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//div'</span><span class="token punctuation">)</span>
submitTag1 <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span><span class="token string">'//div'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>find_element_by_css_selector</code>：根据css选择器选择元素。等价于：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span><span class="token string">'//div'</span><span class="token punctuation">)</span>
submitTag1 <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>CSS_SELECTOR<span class="token punctuation">,</span><span class="token string">'//div'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>注意，<code>find_element</code>是获取第一个满足条件的元素。<code>find_elements</code>是获取所有满足条件的元素。<br><code>find_element_by_id</code>这些方法使用Python写的，查找HTML元素的性能不如xpath，如果不需要和浏览器内容进行交互（如点击 或向输入框输入内容），可以将网页源代码扔给lxml来解析<code>etree.HTML(driver.page_source)</code></p>
<h4 id="操作表单元素："><a href="#操作表单元素：" class="headerlink" title="操作表单元素："></a>操作表单元素：</h4></li>
<li><p>操作输入框：分为两步。第一步：找到这个元素。第二步：使用<code>send_keys(value)</code>，将数据填充进去。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'kw'</span><span class="token punctuation">)</span>
inputTag<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>使用<code>clear</code>方法可以清除输入框中的内容。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputTag<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>操作checkbox：因为要选中<code>checkbox</code>标签，在网页中是通过鼠标点击的。因此想要选中<code>checkbox</code>标签，那么先选中这个标签，然后执行<code>click</code>事件。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">rememberTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">"rememberMe"</span><span class="token punctuation">)</span>
rememberTag<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>选择select：select元素不能直接点击。因为点击后还需要选中元素。这时候selenium就专门为select标签提供了一个类<code>selenium.webdriver.support.ui.Select</code>。将获取到的元素当成参数传到这个类中，创建这个对象。以后就可以使用这个对象进行选择了。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> Select
 <span class="token comment"># 选中这个标签，然后使用Select创建对象</span>
 selectTag <span class="token operator">=</span> Select<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">"jumpMenu"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token comment"># 根据索引选择</span>
 selectTag<span class="token punctuation">.</span>select_by_index<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token comment"># 根据值选择</span>
 selectTag<span class="token punctuation">.</span>select_by_value<span class="token punctuation">(</span><span class="token string">"http://www.95yueba.com"</span><span class="token punctuation">)</span>
 <span class="token comment"># 根据可视的文本选择</span>
 selectTag<span class="token punctuation">.</span>select_by_visible_text<span class="token punctuation">(</span><span class="token string">"95秀客户端"</span><span class="token punctuation">)</span>
 <span class="token comment"># 取消选中所有选项</span>
 selectTag<span class="token punctuation">.</span>deselect_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>操作按钮：操作按钮有很多种方式。比如单击、右击、双击等。这里讲一个最常用的。就是点击。直接调用<code>click</code>函数就可以了。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'su'</span><span class="token punctuation">)</span>
 inputTag<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="行为链："><a href="#行为链：" class="headerlink" title="行为链："></a>行为链：</h4><p>有时候在页面中的操作可能要有很多步，那么这时候可以使用鼠标行为链类<code>ActionChains</code>来完成。比如现在要将鼠标移动到某个元素上并执行点击事件。那么示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">inputTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'kw'</span><span class="token punctuation">)</span>
submitTag <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'su'</span><span class="token punctuation">)</span>
actions <span class="token operator">=</span> ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>move_to_element<span class="token punctuation">(</span>inputTag<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>send_keys_to_element<span class="token punctuation">(</span>inputTag<span class="token punctuation">,</span><span class="token string">'python'</span><span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>move_to_element<span class="token punctuation">(</span>submitTag<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>click<span class="token punctuation">(</span>submitTag<span class="token punctuation">)</span>
actions<span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还有更多的鼠标相关的操作。</p>
</li>
</ol>
<ul>
<li>click_and_hold(element)：点击但不松开鼠标。</li>
<li>context_click(element)：右键点击。</li>
<li>double_click(element)：双击。</li>
</ul>
<p>自动化测试中用的比较多，但是爬虫用的不多，了解即可<br>更多方法请参考：<a target="_blank" rel="noopener" href="http://_selenium-python.readthedocs.io_api/">http://selenium-python.readthedocs.io/api.html</a></p>
<h4 id="Cookie操作："><a href="#Cookie操作：" class="headerlink" title="Cookie操作："></a>Cookie操作：</h4><ol>
<li><p>获取所有的<code>cookie</code>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> cookie <span class="token keyword">in</span> driver<span class="token punctuation">.</span>get_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>根据cookie的key获取value：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">value <span class="token operator">=</span> driver<span class="token punctuation">.</span>get_cookie<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>删除所有的cookie：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">driver<span class="token punctuation">.</span>delete_all_cookies<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>删除某个<code>cookie</code>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">driver<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>设置cookie</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cookie2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"BDUSS"</span><span class="token punctuation">,</span><span class="token string">"value"</span><span class="token punctuation">:</span><span class="token string">"UJJTH5rcE9qd1VsWDZ5SzFsQkJVZUVPZTMwRi05bzg4UDE5YXJYZDAzNklkRzViQVFBQUFBJCQAAAAAAAAAAAEAAADzdT9HTGlseTAyNTE4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIjnRluI50Zbe"</span><span class="token punctuation">}</span>
driver<span class="token punctuation">.</span>add_cookie<span class="token punctuation">(</span>cookie2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="页面等待："><a href="#页面等待：" class="headerlink" title="页面等待："></a>页面等待：</h4><p>现在的网页越来越多采用了 Ajax 技术，这样程序便不能确定何时某个元素完全加载出来了。如果实际页面等待时间过长导致某个dom元素还没出来，但是你的代码直接使用了这个WebElement，那么就会抛出NullPointer的异常。为了解决这个问题。所以 Selenium 提供了两种等待方式：一种是隐式等待、一种是显式等待。</p>
</li>
<li><p>隐式等待：调用<code>driver.implicitly_wait</code>。那么在获取不可用的元素之前，会先等待10秒中的时间。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span>driver_path<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment"># 请求网页</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.douban.com/"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>显示等待：显示等待是表明某个条件成立后才执行获取元素的操作。也可以在等待的时候指定一个最大的时间，如果超过这个时间那么就抛出一个异常。显示等待应该使用<code>selenium.webdriver.support.excepted_conditions</code>期望的条件和<code>selenium.webdriver.support.ui.WebDriverWait</code>来配合完成。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
 <span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
 <span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait
 <span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions <span class="token keyword">as</span> EC
 driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Firefox<span class="token punctuation">(</span><span class="token punctuation">)</span>
 driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://somedomain/url_that_delays_loading"</span><span class="token punctuation">)</span>
 <span class="token keyword">try</span><span class="token punctuation">:</span>
     element <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>
         EC<span class="token punctuation">.</span>presence_of_element_located<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"myDynamicElement"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">)</span>
 <span class="token keyword">finally</span><span class="token punctuation">:</span>
     driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>一些其他的等待条件：</p>
<ul>
<li>presence_of_element_located：某个元素已经加载完毕了。</li>
<li>presence_of_all_emement_located：网页中所有满足条件的元素都加载完毕了。</li>
<li>element_to_be_cliable：某个元素是可以点击了。<br>更多条件请参考：<a target="_blank" rel="noopener" href="http://_selenium-python.readthedocs.io_waits/">http://selenium-python.readthedocs.io/waits.html</a></li>
</ul>
</li>
</ol>
<p>示例：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1559629/1601216560838-b14083d5-3c2c-49a3-aa36-eb570601507d.png#id=qUzfC&amp;originHeight=577&amp;originWidth=426&amp;originalType=binary&amp;ratio=1&amp;status=done&amp;style=none"></p>
<h4 id="切换页面："><a href="#切换页面：" class="headerlink" title="切换页面："></a>切换页面：</h4><p>有时候窗口中有很多子tab页面。这时候肯定是需要进行切换的。<code>selenium</code>提供了一个叫做<code>switch_to_window</code>来进行切换，具体切换到哪个页面，可以从<code>driver.window_handles</code>中找到。示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 打开一个新的页面</span>
self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.open('"</span><span class="token operator">+</span>url<span class="token operator">+</span><span class="token string">"')"</span><span class="token punctuation">)</span>
<span class="token comment"># 切换到这个新的页面中</span>
self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to_window<span class="token punctuation">(</span>self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>window_handles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>switch_to_window和switch_to.window作用是一样的</code>，selenium最新版本的推荐使用<code>switch_to.window()</code><br>示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">)</span>
<span class="token comment"># driver.get("https://www.douban.com/")     #直接在当前百度的页面打开豆瓣</span>
driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.open('https://www.douban.com/')"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>window_handles<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>switch_to_window<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>window_handles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>current_url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">)</span>
<span class="token comment"># 虽然在窗口中切换到了新的页面。但是driver中还没有切换。</span>
<span class="token comment"># 如果想要在代码中切换到新的页面，并且做一些爬虫。</span>
<span class="token comment"># 那么应该使用driver.switch_to_window来切换到指定的窗口</span>
<span class="token comment"># 从driver.window_handlers中取出具体第几个窗口</span>
<span class="token comment"># driver.window_handlers是一个列表，里面装的都是窗口句柄。</span>
<span class="token comment"># 他会按照打开页面的顺序来存储窗口的句柄。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="设置代理ip："><a href="#设置代理ip：" class="headerlink" title="设置代理ip："></a>设置代理ip：</h4><p>demo10.py<br>有时候频繁爬取一些网页。服务器发现你是爬虫后会封掉你的ip地址。这时候我们可以更改代理ip。更改代理ip，不同的浏览器有不同的实现方式。这里以<code>Chrome</code>浏览器为例来讲解：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--proxy-server=http://110.73.2.248:8123"</span><span class="token punctuation">)</span>
driver_path <span class="token operator">=</span> <span class="token string">r"D:\ProgramApp\chromedriver\chromedriver.exe"</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span>driver_path<span class="token punctuation">,</span>chrome_options<span class="token operator">=</span>options<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/ip'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="WebElement元素："><a href="#WebElement元素：" class="headerlink" title="WebElement元素："></a><code>WebElement</code>元素：</h4><p>demo8.py<br><code>from selenium.webdriver.remote.webelement import WebElement</code>类是每个获取出来的元素的所属类。<br>源码分析</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""Represents a DOM element.
    Generally, all interesting operations that interact with a document will be
    performed through this interface.
    All method calls will do a freshness check to ensure that the element
    reference is still valid.  This essentially determines whether or not the
    element is still attached to the DOM.  If this test fails, then an
    ``StaleElementReferenceException`` is thrown, and all future calls to this
    instance will fail."""</span>
代表一个DOM元素。一般来说，所有与文档交互的有趣的操作都将是通过这个接口执行。
所有的方法调用都会做一个新鲜度检查，以确保元素仍然有效。 这实质上决定了元素仍然连接到DOM。 如果这个测试失败，那么抛出 <span class="token string">"StaleElementReferenceException"</span>，今后所有对这个例子会失败。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>submitBtn.tag_name：获取标签名</p>
</li>
<li><p>submitBtn.text</p>
</li>
<li><p>submitBtn.click()</p>
</li>
<li><p>submitBtn.submit()</p>
</li>
<li><p>inputTag.clear()</p>
</li>
<li><p>get_attribute(“value”)：这个标签的某个属性的值。</p>
</li>
<li><p>screentshot：获取当前页面的截图。这个方法只能在<code>driver</code>上使用。<code>driver.save_screenshot('baidu.png')</code></p>
</li>
<li><p>is_selected()：返回这个元素是否被选中</p>
</li>
<li><p>is_enabled()：返回这个元素是否可用</p>
</li>
<li><p>定位元素的一些方法：</p>
<blockquote>
<p>divTag.find_element_by_id()<br>…</p>
</blockquote>
</li>
<li><p>inputTag.send_keys(“python”)：想输入框input输入内容</p>
</li>
<li><p>inputTag.is_displayed()：该标签是否可见</p>
</li>
</ul>
<p><code>driver</code>的对象类，也是继承自<code>WebElement</code>。<br>更多请阅读源代码。<br>示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">submitBtn <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'su'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>submitBtn<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#&lt;class 'selenium.webdriver.remote.webelement.WebElement'&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>submitBtn<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">#百度一下</span>
driver<span class="token punctuation">.</span>save_screenshot<span class="token punctuation">(</span><span class="token string">'baidu.png'</span><span class="token punctuation">)</span>     <span class="token comment">#保存屏幕截图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="driver的属性和方法"><a href="#driver的属性和方法" class="headerlink" title="driver的属性和方法"></a>driver的属性和方法</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>webelement <span class="token keyword">import</span> WebElement
driver_path <span class="token operator">=</span> <span class="token string">r"C:\programApps\chromedriver\chromedriver.exe"</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span>driver_path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们使用Python内置函数<code>dir()</code>打印出driver的所有属性和方法：<br><code>print(dir(driver))</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>‘NATIVE_EVENTS_ALLOWED’, ‘class’, ‘delattr’, ‘dict’, ‘doc’, ‘format’, ‘getattribute’, ‘hash’, ‘init’, ‘module’, ‘new’, ‘reduce’, ‘reduce_ex’, ‘repr’, ‘setattr’, ‘sizeof’, ‘str’, ‘subclasshook’, ‘weakref’, ‘_file_detector’, ‘_is_remote’, ‘_mobile’, ‘_switch_to’, ‘_unwrap_value’, ‘_wrap_value’, ‘add_cookie’, ‘application_cache’, ‘back’, ‘binary’, ‘capabilities’, ‘close’, ‘command_executor’, ‘create_web_element’, ‘current_url’, ‘current_window_handle’, ‘delete_all_cookies’, ‘delete_cookie’, ‘desired_capabilities’, ‘error_handler’, ‘execute’, ‘execute_async_script’, ‘execute_script’, ‘file_detector’, ‘find_element’, ‘find_element_by_class_name’, ‘find_element_by_css_selector’, ‘find_element_by_id’, ‘find_element_by_link_text’, ‘find_element_by_name’, ‘find_element_by_partial_link_text’, ‘find_element_by_tag_name’, ‘find_element_by_xpath’, ‘find_elements’, ‘find_elements_by_class_name’, ‘find_elements_by_css_selector’, ‘find_elements_by_id’, ‘find_elements_by_link_text’, ‘find_elements_by_name’, ‘find_elements_by_partial_link_text’, ‘find_elements_by_tag_name’, ‘find_elements_by_xpath’, ‘firefox_profile’, ‘forward’, ‘get’, ‘get_cookie’, ‘get_cookies’, ‘get_log’, ‘get_screenshot_as_base64’, ‘get_screenshot_as_file’, ‘get_screenshot_as_png’, ‘get_window_position’, ‘get_window_size’, ‘implicitly_wait’, ‘log_types’, ‘maximize_window’, ‘mobile’, ‘name’, ‘orientation’, ‘page_source’, ‘profile’, ‘quit’, ‘refresh’, ‘save_screenshot’, ‘session_id’, ‘set_page_load_timeout’, ‘set_script_timeout’, ‘set_window_position’, ‘set_window_size’, ‘start_client’, ‘start_session’, ‘stop_client’, ‘switch_to’, ‘switch_to_active_element’, ‘switch_to_alert’, ‘switch_to_default_content’, ‘switch_to_frame’, ‘switch_to_window’, ‘title’, ‘w3c’, ‘window_handles’<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>总结一下常用的属性和方法如下：</p>
<ul>
<li><p>定位元素的方法</p>
<blockquote>
<ul>
<li>driver.find_element_by_class_name():通过class样式的名称获取想要的内容</li>
<li>dirver.find_element_by_id()：通过id的名称获取想要的内容</li>
<li>driver.find_element_by_link_text():通过输入的文本内容获取对应的链接</li>
<li>driver.find_element_by_css_selector():通过css样式的名称获取想要的内容</li>
<li>driver.find_element_by_tag_name():通过标签的的名称获取想要的内容</li>
<li>driver.find_element_by_xpath():用过某个标签的xpath路径获取想要的内容</li>
</ul>
</blockquote>
<p>注意：find_elements_by_xxx  是获取多个对象</p>
</li>
<li><p>driver.current_url：用于获得当前页面的URL</p>
</li>
<li><p>driver.title：用于获取当前页面的标题</p>
</li>
<li><p>driver.page_source:用于获取页面html源代码</p>
</li>
<li><p>driver.current_window_handle:用于获取当前窗口句柄</p>
</li>
<li><p>driver.window_handles:用于获取所有窗口句柄</p>
</li>
<li><p>driver.get(url):浏览器加载url。实例：driver.get(“http//:<a target="_blank" rel="noopener" href="http://www.baidu.com&quot;/">www.baidu.com"</a>)</p>
</li>
<li><p>driver.switch_to_frame(id或name属性值)：切换到新表单(同一窗口)。若无id或属性值，可先通过xpath定位到iframe，再将值传给switch_to_frame()</p>
</li>
<li><p>driver.switch_to_window(窗口句柄)：切换到新窗口</p>
</li>
<li><p>driver.execute_script(js):执行脚本命令</p>
</li>
<li><p>driver.close()：关闭当前窗口，driver.quit()：关闭浏览器，并且安全关闭session</p>
</li>
<li><p>driver.forward()：浏览器向前（点击向前按钮）</p>
</li>
<li><p>driver.maximize_window():最大化浏览器窗口</p>
</li>
<li><p>driver.maximize_window():最大化浏览器窗口</p>
</li>
<li><p>driver.get_window_size()：获取当前窗口的长和宽</p>
</li>
<li><p>driver.get_window_position()：获取当前窗口坐标</p>
</li>
<li><p>driver.get_screenshot_as_file(filename):截取当前窗口</p>
</li>
<li><p>driver.implicitly_wait(s):隐式等待，通过一定的时长等待页面上某一元素加载完成。若提前定位到元素，则继续执行。若超过时间未加载出，则抛出NoSuchElementException异常</p>
</li>
<li><p>driver.switch_to.parent_frame():跳出当前一级表单。到达离它最近的frame</p>
</li>
<li><p>driver.switch_to_default_content():跳回最外层的页面</p>
</li>
<li><p>driver.switch_to_alert():警告框处理。处理JavaScript所生成的alert,confirm,prompt</p>
</li>
<li><p>driver.get_cookies():获取当前会话所有cookie信息</p>
</li>
<li><p>driver.get_cookie(cookie_name)：返回字典的key为“cookie_name”的cookie信息</p>
</li>
<li><p>driver.add_cookie(cookie_dict):添加cookie。“cookie_dict”指字典对象，必须有name和value值</p>
</li>
<li><p>driver.delete_cookie(name,optionsString):删除cookie信息</p>
</li>
<li><p>driver.delete_all_cookies():删除所有cookie信息</p>
</li>
</ul>
<hr>
<h3 id="4-selenium爬虫示例"><a href="#4-selenium爬虫示例" class="headerlink" title="4.selenium爬虫示例"></a>4.selenium爬虫示例</h3><h4 id="4-1-淘宝登录"><a href="#4-1-淘宝登录" class="headerlink" title="4.1 淘宝登录"></a>4.1 淘宝登录</h4><p>参考：模拟人工拖动（先快后慢）轨迹算法<a target="_blank" rel="noopener" href="http://www.51testing.com/html/41/n-3725241-2.html">http://www.51testing.com/html/41/n-3725241-2.html</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f1fef22a14f4">https://www.jianshu.com/p/f1fef22a14f4</a>   有一些问题识别出来是机器拖动的<br>涉及到如下技术：<br>定位元素、操作表单元素、行为链（拖动滑块验证）</p>
<h4 id="4-2-问卷星填报"><a href="#4-2-问卷星填报" class="headerlink" title="4.2 问卷星填报"></a>4.2 问卷星填报</h4><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c34eaecd615f">https://www.jianshu.com/p/c34eaecd615f</a><br><a target="_blank" rel="noopener" href="https://www.wenjuan.com/report/statistical_report/5ec295223631f27b9d92cfaa?pid=5ec295223631f27b9d92cfaa">https://www.wenjuan.com/report/statistical_report/5ec295223631f27b9d92cfaa?pid=5ec295223631f27b9d92cfaa</a><br>填表网站：<a target="_blank" rel="noopener" href="https://www.wenjuan.com/s/7fA7RjT/">https://www.wenjuan.com/s/7fA7RjT/</a></p>
<h4 id="4-3-拉勾网数据"><a href="#4-3-拉勾网数据" class="headerlink" title="4.3 拉勾网数据"></a>4.3 拉勾网数据</h4><h4 id="4-4-Boss直聘数据"><a href="#4-4-Boss直聘数据" class="headerlink" title="4.4 Boss直聘数据"></a>4.4 Boss直聘数据</h4><p>Boss直聘数据不是通过Ajax发送的，直接查看网页源代码即可找到数据<br><a target="_blank" rel="noopener" href="https://www.zhipin.com/job_detail/?query=python&amp;city=101280600&amp;industry=&amp;position=">https://www.zhipin.com/job_detail/?query=python&amp;city=101280600&amp;industry=&amp;position=</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1559629/1601216560890-3cd9ede8-e675-40d2-b126-1d554f65ca78.png#id=Mmknj&amp;originHeight=513&amp;originWidth=1285&amp;originalType=binary&amp;ratio=1&amp;status=done&amp;style=none"></p>
<hr>
<h2 id="三、验证码识别"><a href="#三、验证码识别" class="headerlink" title="三、验证码识别"></a>三、验证码识别</h2><p>阻碍我们爬虫的。有时候正是在登录或者请求一些数据时候的图形验证码。因此这里我们讲解一种能将图片翻译成文字的技术。将图片翻译成文字一般被成为光学文字识别（Optical Character Recognition），简写为<code>OCR</code>。实现<code>OCR</code>的库不是很多，特别是开源的。因为这块存在一定的技术壁垒（需要大量的数据、算法、机器学习、深度学习知识等），并且如果做好了具有很高的商业价值。因此开源的比较少。这里介绍一个比较优秀的图像识别开源库：Tesseract。</p>
<h3 id="1-Tesseract："><a href="#1-Tesseract：" class="headerlink" title="1.Tesseract："></a>1.Tesseract：</h3><p>Tesseract是一个OCR库，目前由谷歌赞助。Tesseract是目前公认最优秀、最准确的开源OCR库。Tesseract具有很高的识别度，也具有很高的灵活性，他可以通过训练识别任何字体。<br><strong>安装：</strong><br><strong>Windows系统：</strong><br>在以下链接下载可执行文件，然后一顿点击下一步安装即可（放在不需要权限的纯英文路径下）：<br><a target="_blank" rel="noopener" href="https://github.com/tesseract-ocr/">https://github.com/tesseract-ocr/</a><br><strong>Linux系统：</strong><br>可以在以下链接下载源码自行编译。<br><a target="_blank" rel="noopener" href="https://github.com/tesseract-ocr/tesseract/wiki/Compiling">https://github.com/tesseract-ocr/tesseract/wiki/Compiling</a><br>或者在<code>ubuntu</code>下通过以下命令进行安装：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> tesseract-ocr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>Mac系统：</strong><br>用<code>Homebrew</code>即可方便安装：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> tesseract<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>设置环境变量：</strong><br>安装完成后，如果想要在命令行中使用<code>Tesseract</code>，那么应该设置环境变量。<code>Mac</code>和<code>Linux</code>在安装的时候就默认已经设置好了。在<code>Windows</code>下把<code>tesseract.exe</code>所在的路径添加到<code>PATH</code>环境变量中。<br>还有一个环境变量需要设置的是，要把训练的数据文件路径也放到环境变量中。<br>在环境变量中，添加一个<code>TESSDATA_PREFIX=C:\path_to_tesseractdata\teseractdata</code>。</p>
<h3 id="2-在命令行中使用tesseract识别图像："><a href="#2-在命令行中使用tesseract识别图像：" class="headerlink" title="2.在命令行中使用tesseract识别图像："></a>2.在命令行中使用tesseract识别图像：</h3><p>如果想要在<code>cmd</code>下能够使用<code>tesseract</code>命令，那么需要把<code>tesseract.exe</code>所在的目录放到<code>PATH</code>环境变量中。然后使用命令：<code>tesseract 图片路径 文件路径</code>。<br>示例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tesseract a.png a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>那么就会识别出<code>a.png</code>中的图片，并且把文字写入到<code>a.txt</code>中。如果不想写入文件直接想显示在终端，那么不要加文件名就可以了。</p>
<h3 id="3-在代码中使用tesseract识别图像："><a href="#3-在代码中使用tesseract识别图像：" class="headerlink" title="3.在代码中使用tesseract识别图像："></a>3.在代码中使用tesseract识别图像：</h3><p>在<code>Python</code>代码中操作<code>tesseract</code>。需要安装一个库，叫做<code>pytesseract</code>。通过<code>pip</code>的方式即可安装：</p>
<pre class="line-numbers language-none"><code class="language-none">pip install pytesseract<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>并且，需要读取图片，需要借助一个第三方库叫做<code>PIL</code>。通过<code>pip list</code>看下是否安装。如果没有安装，通过<code>pip</code>的方式安装：</p>
<pre class="line-numbers language-none"><code class="language-none">pip install PIL<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用<code>pytesseract</code>将图片上的文字转换为文本文字的示例代码如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 导入pytesseract库</span>
<span class="token keyword">import</span> pytesseract
<span class="token comment"># 导入Image库</span>
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token comment"># 指定tesseract.exe所在的路径</span>
pytesseract<span class="token punctuation">.</span>pytesseract<span class="token punctuation">.</span>tesseract_cmd <span class="token operator">=</span> <span class="token string">r'D:\ProgramApp\TesseractOCR\tesseract.exe'</span>
<span class="token comment"># 打开图片</span>
image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"a.png"</span><span class="token punctuation">)</span>
<span class="token comment"># 调用image_to_string将图片转换为文字</span>
text <span class="token operator">=</span> pytesseract<span class="token punctuation">.</span>image_to_string<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-用pytesseract处理拉勾网图形验证码："><a href="#4-用pytesseract处理拉勾网图形验证码：" class="headerlink" title="4.用pytesseract处理拉勾网图形验证码："></a>4.用<code>pytesseract</code>处理拉勾网图形验证码：</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pytesseract
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> request
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> time
pytesseract<span class="token punctuation">.</span>pytesseract<span class="token punctuation">.</span>tesseract_cmd <span class="token operator">=</span> <span class="token string">r"D:\ProgramApp\TesseractOCR\tesseract.exe"</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    captchaUrl <span class="token operator">=</span> <span class="token string">"https://passport.lagou.com/vcode/create?from=register&amp;refresh=1513081451891"</span>
    request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>captchaUrl<span class="token punctuation">,</span><span class="token string">'captcha.png'</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'captcha.png'</span><span class="token punctuation">)</span>
    text <span class="token operator">=</span> pytesseract<span class="token punctuation">.</span>image_to_string<span class="token punctuation">(</span>image<span class="token punctuation">,</span>lang<span class="token operator">=</span><span class="token string">'eng'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-打码平台识别验证码"><a href="#5-打码平台识别验证码" class="headerlink" title="5.打码平台识别验证码"></a>5.打码平台识别验证码</h3><p>推荐：<br>超级鹰	<a target="_blank" rel="noopener" href="http://www.chaojiying.com/">http://www.chaojiying.com/</a></p>
<h2 id="四、Cookie"><a href="#四、Cookie" class="headerlink" title="四、Cookie"></a>四、Cookie</h2><p>爬虫请求的网页有时需要携带请求首页时或登录后获取的cookie，目前有两种方式处理cookie</p>
<ul>
<li><p>手动处理</p>
<blockquote>
<p>将抓包工具中的cookie粘贴到请求headers中<br>弊端：cookie有时效期，过了时效期又需要重新手动处理</p>
</blockquote>
</li>
<li><p>自动处理</p>
<blockquote>
<p>基于Session对象实现自动处理<br>如何获取一个Session对象：requests.Session()	返回一个session对象<br>session对象的作用：</p>
<ul>
<li>该对象可以像requests一样调用get/post发起请求，只不过如果在使用session发请求的过程中如果产生cookie，则cookie会自动存储在该session对象中，name就意味着下次再使用session对象发请求时，该请求会携带cookie</li>
<li>在爬虫中使用session，session对象至少被使用几次？<ul>
<li>2次，第一次使用session是为了捕获cookie存储到session对象中，第二次使用session.get() 或session.post()发请求时携带上cookie</li>
</ul>
</li>
</ul>
</blockquote>
</li>
</ul>
<p>示例：雪球网请求数据需要携带访问首页时获取的cookie<br>首页：<a target="_blank" rel="noopener" href="https://xueqiu.com/">https://xueqiu.com/</a><br>获得数据发起的ajax请求：<a target="_blank" rel="noopener" href="https://xueqiu.com/statuses/hot/listV2.json?since_id=-1&amp;max_id=218185&amp;size=15">https://xueqiu.com/statuses/hot/listV2.json?since_id=-1&amp;max_id=218185&amp;size=15</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3472.3 Safari/537.36"</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">xueqiu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    main_url <span class="token operator">=</span> <span class="token string">"https://xueqiu.com/"</span>
    session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>main_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>	<span class="token comment">#1.获取cookie存储到session对象中</span>

    url <span class="token operator">=</span> <span class="token string">"https://xueqiu.com/statuses/hot/listV2.json?since_id=-1&amp;max_id=218185&amp;size=15"</span>
    <span class="token comment">#2.使用session对象发起请求时会携带原来存储的cookie</span>
    page_text <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>page_text<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="五、代理proxies"><a href="#五、代理proxies" class="headerlink" title="五、代理proxies"></a>五、代理proxies</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/1559629/1624159396115-d4898c5d-15e9-4c2b-9546-b6e914433a61.png#clientId=u57f588d9-a63e-4&amp;from=paste&amp;id=ucffda80c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=477&amp;originWidth=1014&amp;originalType=binary&amp;ratio=2&amp;size=532537&amp;status=done&amp;style=stroke&amp;taskId=u6a90e242-990e-4056-9feb-426264c7724" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/1559629/1624160315424-6b9b12ef-5308-4bcd-b833-5e4caf4985f3.png#clientId=u57f588d9-a63e-4&amp;from=paste&amp;height=401&amp;id=u76acc42b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=801&amp;originWidth=1151&amp;originalType=binary&amp;ratio=2&amp;size=388866&amp;status=done&amp;style=none&amp;taskId=u047640f2-eaac-4b4d-b3cf-05fe8cc1fce&amp;width=575.5" alt="image.png"><br>推荐购买的代理：<br><a target="_blank" rel="noopener" href="https://www.qg.net/">https://www.qg.net/</a>		青果代理<br><a target="_blank" rel="noopener" href="http://www.jinglingdaili.com/Shop-index.html">http://www.jinglingdaili.com/Shop-index.html</a>		智联HTTP代理</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/1559629/1624160509419-182c7e68-3da8-46f8-b101-563dcb877d44.png#clientId=u57f588d9-a63e-4&amp;from=paste&amp;id=ub62d23ad&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=583&amp;originWidth=1031&amp;originalType=binary&amp;ratio=2&amp;size=483469&amp;status=done&amp;style=shadow&amp;taskId=uf8c58e64-6b00-4ba1-9784-7a6219b0026" alt="image.png"></p>
<h2 id="六、模拟登陆"><a href="#六、模拟登陆" class="headerlink" title="六、模拟登陆"></a>六、模拟登陆</h2><p>案例：模拟登陆<a target="_blank" rel="noopener" href="https://www.gushiwen.cn/">古诗文网</a><br>登陆成功后展示收藏界面<br><img src="https://cdn.nlark.com/yuque/0/2021/png/1559629/1624194674679-ab556a44-1020-4fc6-afb2-96d453ea9a46.png#clientId=ue8566555-2f56-4&amp;from=paste&amp;height=368&amp;id=u30b09a64&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=735&amp;originWidth=1283&amp;originalType=binary&amp;ratio=2&amp;size=114091&amp;status=done&amp;style=none&amp;taskId=u2af2cb0f-ccdf-425d-b09c-4c4916bd5ec&amp;width=641.5" alt="image.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5
<span class="token keyword">import</span> os

headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"user-agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36"</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Chaojiying_Client</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> soft_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        password <span class="token operator">=</span>  password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>password <span class="token operator">=</span> md5<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>soft_id <span class="token operator">=</span> soft_id
        self<span class="token punctuation">.</span>base_params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'user'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
            <span class="token string">'pass2'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
            <span class="token string">'softid'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>soft_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'Keep-Alive'</span><span class="token punctuation">,</span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">PostPic</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> im<span class="token punctuation">,</span> codetype<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        im: 图片字节
        codetype: 题目类型 参考 http://www.chaojiying.com/price.html
        """</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'codetype'</span><span class="token punctuation">:</span> codetype<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        params<span class="token punctuation">.</span>update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_params<span class="token punctuation">)</span>
        files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'userfile'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'ccc.jpg'</span><span class="token punctuation">,</span> im<span class="token punctuation">)</span><span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://upload.chaojiying.net/Upload/Processing.php'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
        <span class="token keyword">return</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">ReportError</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> im_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        im_id:报错题目的图片ID
        """</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'id'</span><span class="token punctuation">:</span> im_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        params<span class="token punctuation">.</span>update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_params<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://upload.chaojiying.net/Upload/ReportError.php'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>params<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
        <span class="token keyword">return</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">autoLoginGusiwen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#1.获取cookie</span>
    base_url <span class="token operator">=</span> <span class="token string">"https://www.gushiwen.cn/"</span>
    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
    session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

    <span class="token comment">#2.获取验证码图片,在任何可能获取cookie的地方我们都用session请求</span>
    get_captcha <span class="token operator">=</span> <span class="token string">"https://so.gushiwen.cn/RandCode.ashx"</span>
    captcha_data <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>get_captcha<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>content
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"captcha.jpg"</span><span class="token punctuation">,</span><span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fb<span class="token punctuation">:</span>
        fb<span class="token punctuation">.</span>write<span class="token punctuation">(</span>captcha_data<span class="token punctuation">)</span>

    <span class="token comment">#删除验证码图片</span>
    <span class="token comment"># if os.path.exists("./captcha.jpg"):</span>
    <span class="token comment">#     os.remove("./captcha.jpg")</span>

    <span class="token comment">#3.验证码识别</span>
    chaojiying <span class="token operator">=</span> Chaojiying_Client<span class="token punctuation">(</span><span class="token string">'xiongjt'</span><span class="token punctuation">,</span> <span class="token string">'xr112358'</span><span class="token punctuation">,</span> <span class="token string">'918609'</span><span class="token punctuation">)</span>
    im <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'captcha.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    captcha_code <span class="token operator">=</span> chaojiying<span class="token punctuation">.</span>PostPic<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token number">1902</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'pic_str'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>captcha_data<span class="token punctuation">)</span>

    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"__VIEWSTATE"</span><span class="token punctuation">:</span> <span class="token string">"QYT6bITNDKjYdvVxdot7+vPqPoibPocr1Uma873iIyDBkxwn4ytNTF6GrEzvWhW6qUoWrDqq8h60wKlA/2v+RWbdkxODYjFlKvuTfQ8fb1wo4tpvv1ln5RLpR7k="</span><span class="token punctuation">,</span>
        <span class="token string">"__VIEWSTATEGENERATOR"</span><span class="token punctuation">:</span> <span class="token string">"C93BE1AE"</span><span class="token punctuation">,</span>
        <span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"http://so.gushiwen.cn/user/collect.aspx?sort=t"</span><span class="token punctuation">,</span>
        <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"15990076961"</span><span class="token punctuation">,</span>
        <span class="token string">"pwd"</span><span class="token punctuation">:</span> <span class="token string">"xr112358"</span><span class="token punctuation">,</span>
        <span class="token string">"code"</span><span class="token punctuation">:</span> captcha_code<span class="token punctuation">,</span>
        <span class="token string">"denglu"</span><span class="token punctuation">:</span> <span class="token string">"登录"</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#4.登录</span>
    login_url <span class="token operator">=</span> <span class="token string">"https://so.gushiwen.cn/user/login.aspx?from=http%3a%2f%2fso.gushiwen.cn%2fuser%2fcollect.aspx%3fsort%3dt"</span>
    response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> response<span class="token punctuation">.</span>apparent_encoding
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"gusiwen.html"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fw<span class="token punctuation">:</span>
        fw<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>



<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    autoLoginGusiwen<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>重点：</strong><br>第4步 登陆post提交数据中有两组乱序的请求参数，最好去多次刷新页面手动测试登陆看是否为动态变化数据，<br>__VIEWSTATE<br>__VIEWSTATEGENERATOR</p>
<blockquote>
<p>处理方式：</p>
<ul>
<li>常规来讲一般动态变化的请求参数会被隐藏在前台页面中，那么我们就要借助Chrome抓包工具去前台页面源码中搜索</li>
<li>如果前台页面中没有，我们就要借助抓包工具进行全局搜索</li>
</ul>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/1559629/1624195267375-408c1a32-3242-4479-b418-c8b3ca116ce8.png#clientId=ue8566555-2f56-4&amp;from=paste&amp;id=ua37d076c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=997&amp;originWidth=1688&amp;originalType=binary&amp;ratio=2&amp;size=271378&amp;status=done&amp;style=shadow&amp;taskId=uf00864ae-ef35-43ef-b181-b25360e324b" alt="image.png"></p>
<h2 id="七、使用百度AI"><a href="#七、使用百度AI" class="headerlink" title="七、使用百度AI"></a>七、使用百度AI</h2><ul>
<li>图像识别</li>
<li>语音识别&amp;合成</li>
<li>自然语言处理</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">CoderXiong</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://bfd2018.github.io/2022/06/14/python-pa-chong/python-pa-chong-4-pa-chong-jin-jie/">http://bfd2018.github.io/2022/06/14/python-pa-chong/python-pa-chong-4-pa-chong-jin-jie/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">CoderXiong</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                                <a href="/tags/%E7%88%AC%E8%99%AB/">
                                    <span class="chip bg-color">爬虫</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/zhifubao.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wx.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/06/14/python-pa-chong/python-pa-chong-5-scrapy-kuang-jia/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/38.jpg" class="responsive-img" alt="Python爬虫5-Scrapy框架">
                        
                        <span class="card-title">Python爬虫5-Scrapy框架</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-06-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python%E7%88%AC%E8%99%AB/" class="post-category">
                                    Python爬虫
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                    <a href="/tags/%E7%88%AC%E8%99%AB/">
                        <span class="chip bg-color">爬虫</span>
                    </a>
                    
                    <a href="/tags/Scrapy/">
                        <span class="chip bg-color">Scrapy</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/06/13/da-qian-duan/css-ji-chu-pian/">
                    <div class="card-image">
                        
                        <img src="https://pic.rmb.bdstatic.com/bjh/829f67821d92d8c248fca83743afc37a.png" class="responsive-img" alt="CSS基础篇">
                        
                        <span class="card-title">CSS基础篇</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-06-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CSS/" class="post-category">
                                    CSS
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CSS/">
                        <span class="chip bg-color">CSS</span>
                    </a>
                    
                    <a href="/tags/%E5%89%8D%E7%AB%AF/">
                        <span class="chip bg-color">前端</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Hexo-Xiong<br />'
            + '文章作者: CoderXiong<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022</span>
            
            <a href="/about" target="_blank">CoderXiong</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">425.9k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/BFD2018" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1351655382@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1351655382" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1351655382" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>

        
            <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?7c405b5ffa810bbaa048f6a986ca94a5";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

        
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <style>
    #backTop{
        margin-bottom: 110px;
    }
</style>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?7c405b5ffa810bbaa048f6a986ca94a5";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    
    <script>
        (function (i, s, o, g, r, a, m) {
            i["DaoVoiceObject"] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            a.charset = "utf-8";
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
            "//widget.daovoice.io/widget/6984b559.js", "daovoice")
        daovoice('init', {
            app_id: "6f359642"
        });
        daovoice('update');
    </script>
    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

    <!-- 天气接口 -->
    
        <!-- 天气接口-->
<script type="text/javascript">
    WIDGET = { FID: '1tFpFZ5Mtj' }
</script>
<script type="text/javascript">
    //只在桌面版网页启用特效
    var windowWidth = $(window).width();
    if (windowWidth > 768) {
        document.write('<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"><\/script>');
    }
</script>
    

</body>

</html>
